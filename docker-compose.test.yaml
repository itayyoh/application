services:
  web:
    extends:
      file: docker-compose.yaml
      service: web
    build:
      target: runtime
    environment:
      - FLASK_ENV=testing
      - TESTING=True
    ports:
      - "5000:5000"

  mongodb:
    extends:
      file: docker-compose.yaml
      service: mongodb
    ports:
      - "27017:27017"
    networks:
      - app-network
    
  nginx:
    extends:
      file: docker-compose.yaml
      service: nginx
    ports:
      - "80:80"
    networks:
      - app-network
    depends_on:
      web:
        condition: service_healthy

networks:
  app-network:
    driver: bridge

volumes:
  mongodb_data: